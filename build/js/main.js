"use strict";

var wheelBtn = document.querySelector(".land__wheel-btn");
var wheelSector = document.querySelector(".land__wheel-sector");
var popup = document.querySelector(".popup");
var popupBtn = document.querySelector(".popup__btn");

// Ініціалізація звуків
var backgroundMusic = new Audio('music.mp3'); // фоновий звук, грає постійно
var reelSound = new Audio('reels.mp3'); // звук кручення колеса
var reelStopSound = new Audio('reel-stop.mp3'); // звук коли випадає сектор
var popupSound = new Audio('popup.mp3'); // звук для попапу

// Функція для запуску фонової музики
function playBackgroundMusic() {
  backgroundMusic.play()["catch"](function (err) {
    return console.log(err);
  });
}
backgroundMusic.addEventListener('ended', function () {
  playBackgroundMusic();
});

// так як сучасні браузери лочать автовідтворення музики на сайтах, вішаєм слухачі подій які запустять її
document.addEventListener('mousemove', playBackgroundMusic, {
  once: true
});
document.addEventListener('mouseenter', playBackgroundMusic, {
  once: true
});
document.addEventListener('click', playBackgroundMusic, {
  once: true
});
document.addEventListener('touchstart', playBackgroundMusic, {
  once: true
});
playBackgroundMusic();
popupBtn.addEventListener("click", function () {
  if (popup.classList.contains("_first")) {
    popup.classList.remove("_opacity", "_zIndex");
    wheelBtn.style.pointerEvents = "initial";
  }
});
var spinCounter = 0;
function spinWheel(wheel, anim, position, popup, btn) {
  wheel.classList.add(anim);

  //звук кручення колеса
  setTimeout(function () {
    reelSound.play();
  }, 1000);

  // Зупиняємо звук кручення колеса
  setTimeout(function () {
    reelSound.pause();
    reelSound.currentTime = 0;
  }, 4800);
  wheel.addEventListener("animationend", function () {
    wheel.classList.remove(anim);
    wheel.style.transform = "rotate(".concat(position, "deg)");

    // звук зупинки колеса
    reelStopSound.play();
    popup.classList.add("_opacity", "_zIndex");
    btn.classList.add("_btnPulse");
    setTimeout(function () {
      // Відтворюємо звук для попапу
      popupSound.play();
    }, 600);
  }, {
    once: true
  });
}
wheelBtn.addEventListener("click", function () {
  wheelBtn.style.pointerEvents = "none";
  if (spinCounter === 0) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "firstSpin", 1620, popup, wheelBtn);
    popup.classList.add("_first");
    spinCounter++;
    return;
  }
  if (spinCounter === 1) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "secondSpin", 2744.5, popup, wheelBtn);
    popup.classList.add("_second");
    popup.classList.remove("_first");
    setTimeout(function () {
      document.querySelector(".all-link").classList.remove("_hidden");
    }, 8500);
    spinCounter++;
    return;
  }
});

// parallax
var moveSpeed = 260;
if (window.innerWidth > 950) {
  document.addEventListener("mousemove", parallax);
}
function parallax(e) {
  document.querySelectorAll(".parallax").forEach(function (item) {
    var moving_value = item.getAttribute("data-value");
    var y = e.clientX * moving_value / moveSpeed;
    var x = e.clientY * moving_value / moveSpeed;
    var z = e.clientY * moving_value / moveSpeed * 2;
    item.style.transform = "perspective(300px) translate3d(".concat(x, "px, ").concat(y, "px, ").concat(z, "px)");
  });
}

// TDS script

(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2', 'param3', 'param4', 'creative_type', 'creative_id'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));
    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  }

  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
      parent = e.target.closest('a');
    if (parent.getAttribute('href') !== 'https://tds.favbet.partners') {
      return;
    }
    if (parent) {
      e.preventDefault();
      var affid = localStorage.getItem('affid');
      var cpaid = localStorage.getItem('cpaid');
      if (localStorage.getItem("redirectUrl")) {
        link = new URL(localStorage.getItem("redirectUrl"));
      } else {
        link = new URL(parent.href);
        if (affid && cpaid) {
          link.pathname = '/' + affid + '/' + cpaid;
        }
      }
      params.forEach(function (param) {
        if (url.searchParams.has(param)) {
          link.searchParams.set(param, localStorage.getItem(param));
        }
      });
      document.location.href = link;
    }
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsid2hlZWxCdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aGVlbFNlY3RvciIsInBvcHVwIiwicG9wdXBCdG4iLCJiYWNrZ3JvdW5kTXVzaWMiLCJBdWRpbyIsInJlZWxTb3VuZCIsInJlZWxTdG9wU291bmQiLCJwb3B1cFNvdW5kIiwicGxheUJhY2tncm91bmRNdXNpYyIsInBsYXkiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInJlbW92ZSIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInNwaW5Db3VudGVyIiwic3BpbldoZWVsIiwid2hlZWwiLCJhbmltIiwicG9zaXRpb24iLCJidG4iLCJhZGQiLCJzZXRUaW1lb3V0IiwicGF1c2UiLCJjdXJyZW50VGltZSIsInRyYW5zZm9ybSIsIm1vdmVTcGVlZCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJwYXJhbGxheCIsImUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJtb3ZpbmdfdmFsdWUiLCJnZXRBdHRyaWJ1dGUiLCJ5IiwiY2xpZW50WCIsIngiLCJjbGllbnRZIiwieiIsInVybCIsIlVSTCIsImxvY2F0aW9uIiwiaHJlZiIsInBhcmFtcyIsImxpbmtQYXJhbXMiLCJzZWFyY2hQYXJhbXMiLCJoYXMiLCJyZWRpcmVjdFVybCIsImdldCIsIm1hdGNoIiwibGVuZ3RoIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInBhcmFtIiwibGlua1BhcmFtIiwibGluayIsInBhcmVudCIsInRhcmdldCIsImNsb3Nlc3QiLCJwcmV2ZW50RGVmYXVsdCIsImFmZmlkIiwiZ2V0SXRlbSIsImNwYWlkIiwicGF0aG5hbWUiLCJzZXQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsUUFBUSxHQUFHQyxRQUFRLENBQUNDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztBQUMzRCxJ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QUFDO0lBRWxDLElBQUlGLE1BQU0sQ0FBQ3ZCLFlBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyw2QkFBNkIsRUFBRTtNQUMvRDtJQUNKO0lBRUEsSUFBSXVCLE1BQU0sRUFBRTtNQUNSNUIsQ0FBQyxDQUFDK0IsY0FBYyxFQUFFO01BQ2xCLElBQUlDLEtBQUssR0FBR1QsWUFBWSxDQUFDVSxPQUFPLENBQUMsT0FBTyxDQUFDO01BQ3pDLElBQUlDLEtBQUssR0FBR1gsWUFBWSxDQUFDVSxPQUFPLENBQUMsT0FBTyxDQUFDO01BRXpDLElBQUlWLFlBQVksQ0FBQ1UsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1FBQ3JDTixJQUFJLEdBQUcsSUFBSWYsR0FBRyxDQUFDVyxZQUFZLENBQUNVLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztNQUN2RCxDQUFDLE1BQU07UUFDSE4sSUFBSSxHQUFHLElBQUlmLEdBQUcsQ0FBQ2dCLE1BQU0sQ0FBQ2QsSUFBSSxDQUFDO1FBQzNCLElBQUlrQixLQUFLLElBQUlFLEtBQUssRUFBRTtVQUNoQlAsSUFBSSxDQUFDUSxRQUFRLEdBQUcsR0FBRyxHQUFHSCxLQUFLLEdBQUcsR0FBRyxHQUFHRSxLQUFLO1FBQzdDO01BQ0o7TUFFQW5CLE1BQU0sQ0FBQ2IsT0FBTyxDQUFDLFVBQVV1QixLQUFLLEVBQUU7UUFDNUIsSUFBSWQsR0FBRyxDQUFDTSxZQUFZLENBQUNDLEdBQUcsQ0FBQ08sS0FBSyxDQUFDLEVBQUU7VUFDN0JFLElBQUksQ0FBQ1YsWUFBWSxDQUFDbUIsR0FBRyxDQUFDWCxLQUFLLEVBQUVGLFlBQVksQ0FBQ1UsT0FBTyxDQUFDUixLQUFLLENBQUMsQ0FBQztRQUM3RDtNQUNKLENBQUMsQ0FBQztNQUVGOUQsUUFBUSxDQUFDa0QsUUFBUSxDQUFDQyxJQUFJLEdBQUdhLElBQUk7SUFDakM7RUFDSixDQUFDLENBQUM7QUFDTixDQUFDLEdBQUciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHdoZWVsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5sYW5kX193aGVlbC1idG5cIik7XG5jb25zdCB3aGVlbFNlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubGFuZF9fd2hlZWwtc2VjdG9yXCIpO1xuY29uc3QgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwXCIpO1xuY29uc3QgcG9wdXBCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idG5cIik7XG5cbi8vINCG0L3RltGG0ZbQsNC70ZbQt9Cw0YbRltGPINC30LLRg9C60ZbQslxuY29uc3QgYmFja2dyb3VuZE11c2ljID0gbmV3IEF1ZGlvKCdtdXNpYy5tcDMnKTsgLy8g0YTQvtC90L7QstC40Lkg0LfQstGD0LosINCz0YDQsNGUINC/0L7RgdGC0ZbQudC90L5cbmNvbnN0IHJlZWxTb3VuZCA9IG5ldyBBdWRpbygncmVlbHMubXAzJyk7IC8vINC30LLRg9C6INC60YDRg9GH0LXQvdC90Y8g0LrQvtC70LXRgdCwXG5jb25zdCByZWVsU3RvcFNvdW5kID0gbmV3IEF1ZGlvKCdyZWVsLXN0b3AubXAzJyk7IC8vINC30LLRg9C6INC60L7Qu9C4INCy0LjQv9Cw0LTQsNGUINGB0LXQutGC0L7RgFxuY29uc3QgcG9wdXBTb3VuZCA9IG5ldyBBdWRpbygncG9wdXAubXAzJyk7IC8vINC30LLRg9C6INC00LvRjyDQv9C+0L/QsNC/0YNcblxuLy8g0KTRg9C90LrRhtGW0Y8g0LTQu9GPINC30LDQv9GD0YHQutGDINGE0L7QvdC+0LLQvtGXINC80YPQt9C40LrQuFxuZnVuY3Rpb24gcGxheUJhY2tncm91bmRNdXNpYygpIHtcbiAgICBiYWNrZ3JvdW5kTXVzaWMucGxheSgpLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbn1cblxuYmFja2dyb3VuZE11c2ljLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgZnVuY3Rpb24oKSB7XG4gICAgcGxheUJhY2tncm91bmRNdXNpYygpO1xufSk7XG5cbi8vINGC0LDQuiDRj9C6INGB0YPRh9Cw0YHQvdGWINCx0YDQsNGD0LfQtdGA0Lgg0LvQvtGH0LDRgtGMINCw0LLRgtC+0LLRltC00YLQstC+0YDQtdC90L3RjyDQvNGD0LfQuNC60Lgg0L3QsCDRgdCw0LnRgtCw0YUsINCy0ZbRiNCw0ZTQvCDRgdC70YPRhdCw0YfRliDQv9C+0LTRltC5INGP0LrRliDQt9Cw0L/Rg9GB0YLRj9GC0Ywg0ZfRl1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgcGxheUJhY2tncm91bmRNdXNpYywgeyBvbmNlOiB0cnVlIH0pO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIHBsYXlCYWNrZ3JvdW5kTXVzaWMsIHsgb25jZTogdHJ1ZSB9KTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheUJhY2tncm91bmRNdXNpYywgeyBvbmNlOiB0cnVlIH0pO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHBsYXlCYWNrZ3JvdW5kTXVzaWMsIHsgb25jZTogdHJ1ZSB9KTtcbnBsYXlCYWNrZ3JvdW5kTXVzaWMoKVxuXG5wb3B1cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmIChwb3B1cC5jbGFzc0xpc3QuY29udGFpbnMoXCJfZmlyc3RcIikpIHtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIl9vcGFjaXR5XCIsIFwiX3pJbmRleFwiKTtcbiAgICAgICAgd2hlZWxCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiaW5pdGlhbFwiO1xuICAgIH1cblxufSk7XG5cbmxldCBzcGluQ291bnRlciA9IDA7XG5cbmZ1bmN0aW9uIHNwaW5XaGVlbCh3aGVlbCwgYW5pbSwgcG9zaXRpb24sIHBvcHVwLCBidG4pIHtcbiAgICB3aGVlbC5jbGFzc0xpc3QuYWRkKGFuaW0pO1xuXG4gICAgLy/Qt9Cy0YPQuiDQutGA0YPRh9C10L3QvdGPINC60L7Qu9C10YHQsFxuICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgIHJlZWxTb3VuZC5wbGF5KCk7XG4gICAgfSwgMTAwMClcblxuICAgIC8vINCX0YPQv9C40L3Rj9GU0LzQviDQt9Cy0YPQuiDQutGA0YPRh9C10L3QvdGPINC60L7Qu9C10YHQsFxuICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgIHJlZWxTb3VuZC5wYXVzZSgpO1xuICAgICAgICByZWVsU291bmQuY3VycmVudFRpbWUgPSAwO1xuICAgIH0sIDQ4MDApXG5cblxuICAgIHdoZWVsLmFkZEV2ZW50TGlzdGVuZXIoXCJhbmltYXRpb25lbmRcIiwgKCkgPT4ge1xuICAgICAgICB3aGVlbC5jbGFzc0xpc3QucmVtb3ZlKGFuaW0pO1xuICAgICAgICB3aGVlbC5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlKCR7cG9zaXRpb259ZGVnKWA7XG5cblxuXG4gICAgICAgIC8vINC30LLRg9C6INC30YPQv9C40L3QutC4INC60L7Qu9C10YHQsFxuICAgICAgICByZWVsU3RvcFNvdW5kLnBsYXkoKTtcblxuICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwiX29wYWNpdHlcIiwgXCJfekluZGV4XCIpO1xuICAgICAgICBidG4uY2xhc3NMaXN0LmFkZChcIl9idG5QdWxzZVwiKTtcblxuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICAvLyDQktGW0LTRgtCy0L7RgNGO0ZTQvNC+INC30LLRg9C6INC00LvRjyDQv9C+0L/QsNC/0YNcbiAgICAgICAgICAgIHBvcHVwU291bmQucGxheSgpO1xuICAgICAgICB9LCA2MDApXG5cbiAgICB9LCB7IG9uY2U6IHRydWUgfSk7XG59XG5cbndoZWVsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgd2hlZWxCdG4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgIGlmIChzcGluQ291bnRlciA9PT0gMCkge1xuICAgICAgICB3aGVlbEJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiX2J0blB1bHNlXCIpO1xuICAgICAgICBzcGluV2hlZWwod2hlZWxTZWN0b3IsIFwiZmlyc3RTcGluXCIsIDE2MjAsIHBvcHVwLCB3aGVlbEJ0bik7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJfZmlyc3RcIik7XG4gICAgICAgIHNwaW5Db3VudGVyKys7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoc3BpbkNvdW50ZXIgPT09IDEpIHtcbiAgICAgICAgd2hlZWxCdG4uY2xhc3NMaXN0LnJlbW92ZShcIl9idG5QdWxzZVwiKTtcbiAgICAgICAgc3BpbldoZWVsKHdoZWVsU2VjdG9yLCBcInNlY29uZFNwaW5cIiwgMjc0NC41LCBwb3B1cCwgd2hlZWxCdG4pO1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwiX3NlY29uZFwiKTtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIl9maXJzdFwiKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PntcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWxsLWxpbmtcIikuY2xhc3NMaXN0LnJlbW92ZShcIl9oaWRkZW5cIilcbiAgICAgICAgfSwgODUwMClcblxuICAgICAgICBzcGluQ291bnRlcisrO1xuICAgICAgICByZXR1cm47XG4gICAgfVxufSk7XG5cbi8vIHBhcmFsbGF4XG5jb25zdCBtb3ZlU3BlZWQgPSAyNjA7XG5cbmlmICh3aW5kb3cuaW5uZXJXaWR0aCA+IDk1MCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgcGFyYWxsYXgpO1xufVxuXG5mdW5jdGlvbiBwYXJhbGxheChlKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wYXJhbGxheFwiKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vdmluZ192YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS12YWx1ZVwiKTtcbiAgICAgICAgbGV0IHkgPSAoZS5jbGllbnRYICogbW92aW5nX3ZhbHVlKSAvIG1vdmVTcGVlZDtcbiAgICAgICAgbGV0IHggPSAoZS5jbGllbnRZICogbW92aW5nX3ZhbHVlKSAvIG1vdmVTcGVlZDtcbiAgICAgICAgbGV0IHogPSAoZS5jbGllbnRZICogbW92aW5nX3ZhbHVlKSAvIG1vdmVTcGVlZCAqIDI7XG4gICAgICAgIGl0ZW0uc3R5bGUudHJhbnNmb3JtID0gYHBlcnNwZWN0aXZlKDMwMHB4KSB0cmFuc2xhdGUzZCgke3h9cHgsICR7eX1weCwgJHt6fXB4KWA7XG4gICAgfSk7XG59XG5cblxuLy8gVERTIHNjcmlwdFxuXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cmwgPSBuZXcgVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICB2YXIgcGFyYW1zID0gWydsJywgJ3V0bV9zb3VyY2UnLCAndXRtX21lZGl1bScsICd1dG1fY2FtcGFpZ24nLCAndXRtX3Rlcm0nLCAndXRtX2NvbnRlbnQnLCAncGFyYW0xJywgJ3BhcmFtMicsICdwYXJhbTMnLCAncGFyYW00JywgJ2NyZWF0aXZlX3R5cGUnLCAnY3JlYXRpdmVfaWQnXTtcbiAgICB2YXIgbGlua1BhcmFtcyA9IFsnYWZmaWQnLCAnY3BhaWQnXTsgLy8g0LjRidC10Lwg0LIgdXJsIHJlZGlyZWN0VXJsINCyIHVybDpcblxuICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcygncmVkaXJlY3RVcmwnKSkge1xuICAgICAgICB2YXIgcmVkaXJlY3RVcmwgPSBuZXcgVVJMKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdyZWRpcmVjdFVybCcpKTtcblxuICAgICAgICBpZiAocmVkaXJlY3RVcmwuaHJlZi5tYXRjaCgvXFwvL2cpLmxlbmd0aCA9PT0gNCAmJiByZWRpcmVjdFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsJykpIHtcbiAgICAgICAgICAgIC8v0LXRgdC70Lgg0YHRgdGL0LvQutCwINCyINGB0YHRi9C70LrQsCByZWRpcmVjdFVybCDQutC+0YDRgNC10LrRgtC90LDRj1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlZGlyZWN0VXJsJywgcmVkaXJlY3RVcmwuaHJlZik7IC8vINGD0LrQsNC30YvQstCw0LXQvCDRgtC+0YfQutC+0Lkg0LLRhdC+0LTQsCDQtNC+0LzQtdC9INGBINC/0YDQvtGC0L7QutC+0LvQvtC8INC40LcgcmVkaXJlY3RVcmxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMocGFyYW0pKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwYXJhbSwgdXJsLnNlYXJjaFBhcmFtcy5nZXQocGFyYW0pKTtcbiAgICB9KTtcblxuICAgIGxpbmtQYXJhbXMuZm9yRWFjaChmdW5jdGlvbiAobGlua1BhcmFtKSB7XG4gICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhsaW5rUGFyYW0pKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsaW5rUGFyYW0sIHVybC5zZWFyY2hQYXJhbXMuZ2V0KGxpbmtQYXJhbSkpO1xuICAgIH0pO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGxpbmssXG4gICAgICAgICAgICBwYXJlbnQgPSBlLnRhcmdldC5jbG9zZXN0KCdhJyk7XG5cbiAgICAgICAgaWYgKHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSAhPT0gJ2h0dHBzOi8vdGRzLmZhdmJldC5wYXJ0bmVycycpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBhZmZpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhZmZpZCcpO1xuICAgICAgICAgICAgdmFyIGNwYWlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NwYWlkJyk7XG5cbiAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlZGlyZWN0VXJsXCIpKSB7XG4gICAgICAgICAgICAgICAgbGluayA9IG5ldyBVUkwobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJyZWRpcmVjdFVybFwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpbmsgPSBuZXcgVVJMKHBhcmVudC5ocmVmKTtcbiAgICAgICAgICAgICAgICBpZiAoYWZmaWQgJiYgY3BhaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluay5wYXRobmFtZSA9ICcvJyArIGFmZmlkICsgJy8nICsgY3BhaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYXJhbXMuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMocGFyYW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsuc2VhcmNoUGFyYW1zLnNldChwYXJhbSwgbG9jYWxTdG9yYWdlLmdldEl0ZW0ocGFyYW0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IGxpbms7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7Il19
