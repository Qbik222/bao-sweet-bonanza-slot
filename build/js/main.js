"use strict";

var wheelBtn = document.querySelector(".land__wheel-btn");
var wheelSector = document.querySelector(".land__wheel-sector");
var popup = document.querySelector(".popup");
var popupBtn = document.querySelector(".popup__btn");

// Ініціалізація звуків
var backgroundMusic = new Audio('music.mp3'); // фоновий звук, грає постійно
var reelSound = new Audio('reels.mp3'); // звук кручення колеса
var reelStopSound = new Audio('reel-stop.mp3'); // звук коли випадає сектор
var popupSound = new Audio('popup.mp3'); // звук для попапу

// Функція для запуску фонової музики
function playBackgroundMusic() {
  backgroundMusic.play()["catch"](function (err) {
    return console.log(err);
  });
}

// так як сучасні браузери лочать автовідтворення музики на сайтах, вішаєм слухачі подій які запустять її
document.addEventListener('mousemove', playBackgroundMusic, {
  once: true
});
document.addEventListener('click', playBackgroundMusic, {
  once: true
});
document.addEventListener('touchstart', playBackgroundMusic, {
  once: true
});
playBackgroundMusic();
popupBtn.addEventListener("click", function () {
  if (popup.classList.contains("_first")) {
    popup.classList.remove("_opacity", "_zIndex");
    wheelBtn.style.pointerEvents = "initial";
  }
});
var spinCounter = 0;
function spinWheel(wheel, anim, position, popup, btn) {
  wheel.classList.add(anim);

  //звук кручення колеса
  setTimeout(function () {
    reelSound.play();
  }, 1000);

  // Зупиняємо звук кручення колеса
  setTimeout(function () {
    reelSound.pause();
    reelSound.currentTime = 0;
  }, 4800);
  wheel.addEventListener("animationend", function () {
    wheel.classList.remove(anim);
    wheel.style.transform = "rotate(".concat(position, "deg)");

    // звук зупинки колеса
    reelStopSound.play();
    popup.classList.add("_opacity", "_zIndex");
    btn.classList.add("_btnPulse");
    setTimeout(function () {
      // Відтворюємо звук для попапу
      popupSound.play();
    }, 600);
  }, {
    once: true
  });
}
wheelBtn.addEventListener("click", function () {
  wheelBtn.style.pointerEvents = "none";
  if (spinCounter === 0) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "firstSpin", 1620, popup, wheelBtn);
    popup.classList.add("_first");
    spinCounter++;
    return;
  }
  if (spinCounter === 1) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "secondSpin", 2744.5, popup, wheelBtn);
    popup.classList.add("_second");
    popup.classList.remove("_first");
    setTimeout(function () {
      document.querySelector(".all-link").classList.remove("_hidden");
    }, 8500);
    spinCounter++;
    return;
  }
});

// parallax
var moveSpeed = 260;
if (window.innerWidth > 950) {
  document.addEventListener("mousemove", parallax);
}
function parallax(e) {
  document.querySelectorAll(".parallax").forEach(function (item) {
    var moving_value = item.getAttribute("data-value");
    var y = e.clientX * moving_value / moveSpeed;
    var x = e.clientY * moving_value / moveSpeed;
    var z = e.clientY * moving_value / moveSpeed * 2;
    item.style.transform = "perspective(300px) translate3d(".concat(x, "px, ").concat(y, "px, ").concat(z, "px)");
  });
}

// TDS script

(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2', 'param3', 'param4', 'creative_type', 'creative_id'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));
    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  }

  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
      parent = e.target.closest('a');
    if (parent.getAttribute('href') !== 'https://tds.favbet.partners') {
      return;
    }
    if (parent) {
      e.preventDefault();
      var affid = localStorage.getItem('affid');
      var cpaid = localStorage.getItem('cpaid');
      if (localStorage.getItem("redirectUrl")) {
        link = new URL(localStorage.getItem("redirectUrl"));
      } else {
        link = new URL(parent.href);
        if (affid && cpaid) {
          link.pathname = '/' + affid + '/' + cpaid;
        }
      }
      params.forEach(function (param) {
        if (url.searchParams.has(param)) {
          link.searchParams.set(param, localStorage.getItem(param));
        }
      });
      document.location.href = link;
    }
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsid2hlZWxCdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aGVlbFNlY3RvciIsInBvcHVwIiwicG9wdXBCdG4iLCJiYWNrZ3JvdW5kTXVzaWMiLCJBdWRpbyIsInJlZWxTb3VuZCIsInJlZWxTdG9wU291bmQiLCJwb3B1cFNvdW5kIiwicGxheUJhY2tncm91bmRNdXNpYyIsInBsYXkiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInJlbW92ZSIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInNwaW5Db3VudGVyIiwic3BpbldoZWVsIiwid2hlZWwiLCJhbmltIiwicG9zaXRpb24iLCJidG4iLCJhZGQiLCJzZXRUaW1lb3V0IiwicGF1c2UiLCJjdXJyZW50VGltZSIsInRyYW5zZm9ybSIsIm1vdmVTcGVlZCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJwYXJhbGxheCIsImUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJtb3ZpbmdfdmFsdWUiLCJnZXRBdHRyaWJ1dGUiLCJ5IiwiY2xpZW50WCIsIngiLCJjbGllbnRZIiwieiIsInVybCIsIlVSTCIsImxvY2F0aW9uIiwiaHJlZiIsInBhcmFtcyIsImxpbmtQYXJhbXMiLCJzZWFyY2hQYXJhbXMiLCJoYXMiLCJyZWRpcmVjdFVybCIsImdldCIsIm1hdGNoIiwibGVuZ3RoIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInBhcmFtIiwibGlua1BhcmFtIiwibGluayIsInBhcmVudCIsInRhcmdldCIsImNsb3Nlc3QiLCJwcmV2ZW50RGVmYXVsdCIsImFmZmlkIiwiZ2V0SXRlbSIsImNwYWlkIiwicGF0aG5hbWUiLCJzZXQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsUUFBUSxHQUFHQyxRQUFRLENBQUNDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztBQUMzRCxJ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TyxDQUFDLE9BQU8sQ0FBQztNQUN6QyxJQUFJQyxLQUFLLEdBQUdYLFlBQVksQ0FBQ1UsT0FBTyxDQUFDLE9BQU8sQ0FBQztNQUV6QyxJQUFJVixZQUFZLENBQUNVLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRTtRQUNyQ04sSUFBSSxHQUFHLElBQUlmLEdBQUcsQ0FBQ1csWUFBWSxDQUFDVSxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7TUFDdkQsQ0FBQyxNQUFNO1FBQ0hOLElBQUksR0FBRyxJQUFJZixHQUFHLENBQUNnQixNQUFNLENBQUNkLElBQUksQ0FBQztRQUMzQixJQUFJa0IsS0FBSyxJQUFJRSxLQUFLLEVBQUU7VUFDaEJQLElBQUksQ0FBQ1EsUUFBUSxHQUFHLEdBQUcsR0FBR0gsS0FBSyxHQUFHLEdBQUcsR0FBR0UsS0FBSztRQUM3QztNQUNKO01BRUFuQixNQUFNLENBQUNiLE9BQU8sQ0FBQyxVQUFVdUIsS0FBSyxFQUFFO1FBQzVCLElBQUlkLEdBQUcsQ0FBQ00sWUFBWSxDQUFDQyxHQUFHLENBQUNPLEtBQUssQ0FBQyxFQUFFO1VBQzdCRSxJQUFJLENBQUNWLFlBQVksQ0FBQ21CLEdBQUcsQ0FBQ1gsS0FBSyxFQUFFRixZQUFZLENBQUNVLE9BQU8sQ0FBQ1IsS0FBSyxDQUFDLENBQUM7UUFDN0Q7TUFDSixDQUFDLENBQUM7TUFFRjlELFFBQVEsQ0FBQ2tELFFBQVEsQ0FBQ0MsSUFBSSxHQUFHYSxJQUFJO0lBQ2pDO0VBQ0osQ0FBQyxDQUFDO0FBQ04sQ0FBQyxHQUFHIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB3aGVlbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubGFuZF9fd2hlZWwtYnRuXCIpO1xuY29uc3Qgd2hlZWxTZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxhbmRfX3doZWVsLXNlY3RvclwiKTtcbmNvbnN0IHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cFwiKTtcbmNvbnN0IHBvcHVwQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnRuXCIpO1xuXG4vLyDQhtC90ZbRhtGW0LDQu9GW0LfQsNGG0ZbRjyDQt9Cy0YPQutGW0LJcbmNvbnN0IGJhY2tncm91bmRNdXNpYyA9IG5ldyBBdWRpbygnbXVzaWMubXAzJyk7IC8vINGE0L7QvdC+0LLQuNC5INC30LLRg9C6LCDQs9GA0LDRlCDQv9C+0YHRgtGW0LnQvdC+XG5jb25zdCByZWVsU291bmQgPSBuZXcgQXVkaW8oJ3JlZWxzLm1wMycpOyAvLyDQt9Cy0YPQuiDQutGA0YPRh9C10L3QvdGPINC60L7Qu9C10YHQsFxuY29uc3QgcmVlbFN0b3BTb3VuZCA9IG5ldyBBdWRpbygncmVlbC1zdG9wLm1wMycpOyAvLyDQt9Cy0YPQuiDQutC+0LvQuCDQstC40L/QsNC00LDRlCDRgdC10LrRgtC+0YBcbmNvbnN0IHBvcHVwU291bmQgPSBuZXcgQXVkaW8oJ3BvcHVwLm1wMycpOyAvLyDQt9Cy0YPQuiDQtNC70Y8g0L/QvtC/0LDQv9GDXG5cbi8vINCk0YPQvdC60YbRltGPINC00LvRjyDQt9Cw0L/Rg9GB0LrRgyDRhNC+0L3QvtCy0L7RlyDQvNGD0LfQuNC60LhcbmZ1bmN0aW9uIHBsYXlCYWNrZ3JvdW5kTXVzaWMoKSB7XG4gICAgYmFja2dyb3VuZE11c2ljLnBsYXkoKS5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XG59XG5cbi8vINGC0LDQuiDRj9C6INGB0YPRh9Cw0YHQvdGWINCx0YDQsNGD0LfQtdGA0Lgg0LvQvtGH0LDRgtGMINCw0LLRgtC+0LLRltC00YLQstC+0YDQtdC90L3RjyDQvNGD0LfQuNC60Lgg0L3QsCDRgdCw0LnRgtCw0YUsINCy0ZbRiNCw0ZTQvCDRgdC70YPRhdCw0YfRliDQv9C+0LTRltC5INGP0LrRliDQt9Cw0L/Rg9GB0YLRj9GC0Ywg0ZfRl1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgcGxheUJhY2tncm91bmRNdXNpYywgeyBvbmNlOiB0cnVlIH0pO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5QmFja2dyb3VuZE11c2ljLCB7IG9uY2U6IHRydWUgfSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgcGxheUJhY2tncm91bmRNdXNpYywgeyBvbmNlOiB0cnVlIH0pO1xucGxheUJhY2tncm91bmRNdXNpYygpXG5cbnBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKHBvcHVwLmNsYXNzTGlzdC5jb250YWlucyhcIl9maXJzdFwiKSkge1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiX29wYWNpdHlcIiwgXCJfekluZGV4XCIpO1xuICAgICAgICB3aGVlbEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJpbml0aWFsXCI7XG4gICAgfVxuXG59KTtcblxubGV0IHNwaW5Db3VudGVyID0gMDtcblxuZnVuY3Rpb24gc3BpbldoZWVsKHdoZWVsLCBhbmltLCBwb3NpdGlvbiwgcG9wdXAsIGJ0bikge1xuICAgIHdoZWVsLmNsYXNzTGlzdC5hZGQoYW5pbSk7XG5cbiAgICAvL9C30LLRg9C6INC60YDRg9GH0LXQvdC90Y8g0LrQvtC70LXRgdCwXG4gICAgc2V0VGltZW91dCgoKSA9PntcbiAgICAgICAgcmVlbFNvdW5kLnBsYXkoKTtcbiAgICB9LCAxMDAwKVxuXG4gICAgLy8g0JfRg9C/0LjQvdGP0ZTQvNC+INC30LLRg9C6INC60YDRg9GH0LXQvdC90Y8g0LrQvtC70LXRgdCwXG4gICAgc2V0VGltZW91dCgoKSA9PntcbiAgICAgICAgcmVlbFNvdW5kLnBhdXNlKCk7XG4gICAgICAgIHJlZWxTb3VuZC5jdXJyZW50VGltZSA9IDA7XG4gICAgfSwgNDgwMClcblxuXG4gICAgd2hlZWwuYWRkRXZlbnRMaXN0ZW5lcihcImFuaW1hdGlvbmVuZFwiLCAoKSA9PiB7XG4gICAgICAgIHdoZWVsLmNsYXNzTGlzdC5yZW1vdmUoYW5pbSk7XG4gICAgICAgIHdoZWVsLnN0eWxlLnRyYW5zZm9ybSA9IGByb3RhdGUoJHtwb3NpdGlvbn1kZWcpYDtcblxuXG5cbiAgICAgICAgLy8g0LfQstGD0Log0LfRg9C/0LjQvdC60Lgg0LrQvtC70LXRgdCwXG4gICAgICAgIHJlZWxTdG9wU291bmQucGxheSgpO1xuXG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJfb3BhY2l0eVwiLCBcIl96SW5kZXhcIik7XG4gICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKFwiX2J0blB1bHNlXCIpO1xuXG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PntcbiAgICAgICAgICAgIC8vINCS0ZbQtNGC0LLQvtGA0Y7RlNC80L4g0LfQstGD0Log0LTQu9GPINC/0L7Qv9Cw0L/Rg1xuICAgICAgICAgICAgcG9wdXBTb3VuZC5wbGF5KCk7XG4gICAgICAgIH0sIDYwMClcblxuICAgIH0sIHsgb25jZTogdHJ1ZSB9KTtcbn1cblxud2hlZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICB3aGVlbEJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgaWYgKHNwaW5Db3VudGVyID09PSAwKSB7XG4gICAgICAgIHdoZWVsQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJfYnRuUHVsc2VcIik7XG4gICAgICAgIHNwaW5XaGVlbCh3aGVlbFNlY3RvciwgXCJmaXJzdFNwaW5cIiwgMTYyMCwgcG9wdXAsIHdoZWVsQnRuKTtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZChcIl9maXJzdFwiKTtcbiAgICAgICAgc3BpbkNvdW50ZXIrKztcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChzcGluQ291bnRlciA9PT0gMSkge1xuICAgICAgICB3aGVlbEJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiX2J0blB1bHNlXCIpO1xuICAgICAgICBzcGluV2hlZWwod2hlZWxTZWN0b3IsIFwic2Vjb25kU3BpblwiLCAyNzQ0LjUsIHBvcHVwLCB3aGVlbEJ0bik7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJfc2Vjb25kXCIpO1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiX2ZpcnN0XCIpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+e1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hbGwtbGlua1wiKS5jbGFzc0xpc3QucmVtb3ZlKFwiX2hpZGRlblwiKVxuICAgICAgICB9LCA4NTAwKVxuXG4gICAgICAgIHNwaW5Db3VudGVyKys7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59KTtcblxuLy8gcGFyYWxsYXhcbmNvbnN0IG1vdmVTcGVlZCA9IDI2MDtcblxuaWYgKHdpbmRvdy5pbm5lcldpZHRoID4gOTUwKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBwYXJhbGxheCk7XG59XG5cbmZ1bmN0aW9uIHBhcmFsbGF4KGUpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBhcmFsbGF4XCIpLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgbW92aW5nX3ZhbHVlID0gaXRlbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXZhbHVlXCIpO1xuICAgICAgICBsZXQgeSA9IChlLmNsaWVudFggKiBtb3ZpbmdfdmFsdWUpIC8gbW92ZVNwZWVkO1xuICAgICAgICBsZXQgeCA9IChlLmNsaWVudFkgKiBtb3ZpbmdfdmFsdWUpIC8gbW92ZVNwZWVkO1xuICAgICAgICBsZXQgeiA9IChlLmNsaWVudFkgKiBtb3ZpbmdfdmFsdWUpIC8gbW92ZVNwZWVkICogMjtcbiAgICAgICAgaXRlbS5zdHlsZS50cmFuc2Zvcm0gPSBgcGVyc3BlY3RpdmUoMzAwcHgpIHRyYW5zbGF0ZTNkKCR7eH1weCwgJHt5fXB4LCAke3p9cHgpYDtcbiAgICB9KTtcbn1cblxuXG4vLyBURFMgc2NyaXB0XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHVybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgIHZhciBwYXJhbXMgPSBbJ2wnLCAndXRtX3NvdXJjZScsICd1dG1fbWVkaXVtJywgJ3V0bV9jYW1wYWlnbicsICd1dG1fdGVybScsICd1dG1fY29udGVudCcsICdwYXJhbTEnLCAncGFyYW0yJywgJ3BhcmFtMycsICdwYXJhbTQnLCAnY3JlYXRpdmVfdHlwZScsICdjcmVhdGl2ZV9pZCddO1xuICAgIHZhciBsaW5rUGFyYW1zID0gWydhZmZpZCcsICdjcGFpZCddOyAvLyDQuNGJ0LXQvCDQsiB1cmwgcmVkaXJlY3RVcmwg0LIgdXJsOlxuXG4gICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKCdyZWRpcmVjdFVybCcpKSB7XG4gICAgICAgIHZhciByZWRpcmVjdFVybCA9IG5ldyBVUkwodXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3JlZGlyZWN0VXJsJykpO1xuXG4gICAgICAgIGlmIChyZWRpcmVjdFVybC5ocmVmLm1hdGNoKC9cXC8vZykubGVuZ3RoID09PSA0ICYmIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2wnKSkge1xuICAgICAgICAgICAgLy/QtdGB0LvQuCDRgdGB0YvQu9C60LAg0LIg0YHRgdGL0LvQutCwIHJlZGlyZWN0VXJsINC60L7RgNGA0LXQutGC0L3QsNGPXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncmVkaXJlY3RVcmwnLCByZWRpcmVjdFVybC5ocmVmKTsgLy8g0YPQutCw0LfRi9Cy0LDQtdC8INGC0L7Rh9C60L7QuSDQstGF0L7QtNCwINC00L7QvNC10L0g0YEg0L/RgNC+0YLQvtC60L7Qu9C+0Lwg0LjQtyByZWRpcmVjdFVybFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhwYXJhbSkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHBhcmFtLCB1cmwuc2VhcmNoUGFyYW1zLmdldChwYXJhbSkpO1xuICAgIH0pO1xuXG4gICAgbGlua1BhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5rUGFyYW0pIHtcbiAgICAgICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKGxpbmtQYXJhbSkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxpbmtQYXJhbSwgdXJsLnNlYXJjaFBhcmFtcy5nZXQobGlua1BhcmFtKSk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgbGluayxcbiAgICAgICAgICAgIHBhcmVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2EnKTtcblxuICAgICAgICBpZiAocGFyZW50LmdldEF0dHJpYnV0ZSgnaHJlZicpICE9PSAnaHR0cHM6Ly90ZHMuZmF2YmV0LnBhcnRuZXJzJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGFmZmlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FmZmlkJyk7XG4gICAgICAgICAgICB2YXIgY3BhaWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3BhaWQnKTtcblxuICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVkaXJlY3RVcmxcIikpIHtcbiAgICAgICAgICAgICAgICBsaW5rID0gbmV3IFVSTChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlZGlyZWN0VXJsXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGluayA9IG5ldyBVUkwocGFyZW50LmhyZWYpO1xuICAgICAgICAgICAgICAgIGlmIChhZmZpZCAmJiBjcGFpZCkge1xuICAgICAgICAgICAgICAgICAgICBsaW5rLnBhdGhuYW1lID0gJy8nICsgYWZmaWQgKyAnLycgKyBjcGFpZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhwYXJhbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluay5zZWFyY2hQYXJhbXMuc2V0KHBhcmFtLCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShwYXJhbSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gbGluaztcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiXX0=
