"use strict";

var wheelBtn = document.querySelector(".land__wheel-btn");
var wheelSector = document.querySelector(".land__wheel-sector");
var popup = document.querySelector(".popup");
var popupBtn = document.querySelector(".popup__btn");

// Ініціалізація звуків
var backgroundMusic = new Audio('music.mp3'); // фоновий звук, грає постійно
var reelSound = new Audio('reels.mp3'); // звук кручення колеса
var reelStopSound = new Audio('reel-stop.mp3'); // звук коли випадає сектор
var popupSound = new Audio('popup.mp3'); // звук для попапу

// Функція для запуску фонової музики
function playBackgroundMusic() {
  backgroundMusic.play()["catch"](function (err) {
    return console.log(err);
  });
}

// так як сучасні браузери лочать автовідтворення музики на сайтах, вішаєм слухачі подій які запустять її
document.addEventListener('mousemove', playBackgroundMusic, {
  once: true
});
document.addEventListener('mouseenter', playBackgroundMusic, {
  once: true
});
document.addEventListener('click', playBackgroundMusic, {
  once: true
});
document.addEventListener('touchstart', playBackgroundMusic, {
  once: true
});
playBackgroundMusic();
popupBtn.addEventListener("click", function () {
  if (popup.classList.contains("_first")) {
    popup.classList.remove("_opacity", "_zIndex");
    wheelBtn.style.pointerEvents = "initial";
  }
});
var spinCounter = 0;
function spinWheel(wheel, anim, position, popup, btn) {
  wheel.classList.add(anim);

  //звук кручення колеса
  setTimeout(function () {
    reelSound.play();
  }, 1000);

  // Зупиняємо звук кручення колеса
  setTimeout(function () {
    reelSound.pause();
    reelSound.currentTime = 0;
  }, 4800);
  wheel.addEventListener("animationend", function () {
    wheel.classList.remove(anim);
    wheel.style.transform = "rotate(".concat(position, "deg)");

    // звук зупинки колеса
    reelStopSound.play();
    popup.classList.add("_opacity", "_zIndex");
    btn.classList.add("_btnPulse");
    setTimeout(function () {
      // Відтворюємо звук для попапу
      popupSound.play();
    }, 600);
  }, {
    once: true
  });
}
wheelBtn.addEventListener("click", function () {
  wheelBtn.style.pointerEvents = "none";
  if (spinCounter === 0) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "firstSpin", 1620, popup, wheelBtn);
    popup.classList.add("_first");
    spinCounter++;
    return;
  }
  if (spinCounter === 1) {
    wheelBtn.classList.remove("_btnPulse");
    spinWheel(wheelSector, "secondSpin", 2744.5, popup, wheelBtn);
    popup.classList.add("_second");
    popup.classList.remove("_first");
    setTimeout(function () {
      document.querySelector(".all-link").classList.remove("_hidden");
    }, 8500);
    spinCounter++;
    return;
  }
});

// parallax
var moveSpeed = 260;
if (window.innerWidth > 950) {
  document.addEventListener("mousemove", parallax);
}
function parallax(e) {
  document.querySelectorAll(".parallax").forEach(function (item) {
    var moving_value = item.getAttribute("data-value");
    var y = e.clientX * moving_value / moveSpeed;
    var x = e.clientY * moving_value / moveSpeed;
    var z = e.clientY * moving_value / moveSpeed * 2;
    item.style.transform = "perspective(300px) translate3d(".concat(x, "px, ").concat(y, "px, ").concat(z, "px)");
  });
}

// TDS script

(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2', 'param3', 'param4', 'creative_type', 'creative_id'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));
    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  }

  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
      parent = e.target.closest('a');
    if (parent.getAttribute('href') !== 'https://tds.favbet.partners') {
      return;
    }
    if (parent) {
      e.preventDefault();
      var affid = localStorage.getItem('affid');
      var cpaid = localStorage.getItem('cpaid');
      if (localStorage.getItem("redirectUrl")) {
        link = new URL(localStorage.getItem("redirectUrl"));
      } else {
        link = new URL(parent.href);
        if (affid && cpaid) {
          link.pathname = '/' + affid + '/' + cpaid;
        }
      }
      params.forEach(function (param) {
        if (url.searchParams.has(param)) {
          link.searchParams.set(param, localStorage.getItem(param));
        }
      });
      document.location.href = link;
    }
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsid2hlZWxCdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aGVlbFNlY3RvciIsInBvcHVwIiwicG9wdXBCdG4iLCJiYWNrZ3JvdW5kTXVzaWMiLCJBdWRpbyIsInJlZWxTb3VuZCIsInJlZWxTdG9wU291bmQiLCJwb3B1cFNvdW5kIiwicGxheUJhY2tncm91bmRNdXNpYyIsInBsYXkiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInJlbW92ZSIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInNwaW5Db3VudGVyIiwic3BpbldoZWVsIiwid2hlZWwiLCJhbmltIiwicG9zaXRpb24iLCJidG4iLCJhZGQiLCJzZXRUaW1lb3V0IiwicGF1c2UiLCJjdXJyZW50VGltZSIsInRyYW5zZm9ybSIsIm1vdmVTcGVlZCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJwYXJhbGxheCIsImUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJtb3ZpbmdfdmFsdWUiLCJnZXRBdHRyaWJ1dGUiLCJ5IiwiY2xpZW50WCIsIngiLCJjbGllbnRZIiwieiIsInVybCIsIlVSTCIsImxvY2F0aW9uIiwiaHJlZiIsInBhcmFtcyIsImxpbmtQYXJhbXMiLCJzZWFyY2hQYXJhbXMiLCJoYXMiLCJyZWRpcmVjdFVybCIsImdldCIsIm1hdGNoIiwibGVuZ3RoIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInBhcmFtIiwibGlua1BhcmFtIiwibGluayIsInBhcmVudCIsInRhcmdldCIsImNsb3Nlc3QiLCJwcmV2ZW50RGVmYXVsdCIsImFmZmlkIiwiZ2V0SXRlbSIsImNwYWlkIiwicGF0aG5hbWUiLCJzZXQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsUUFBUSxHQUFHQyxRQUFRLENBQUNDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztBQUMzRCxJ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QSxJQUFJdUIsTUFBTSxFQUFFO01BQ1I1QixDQUFDLENBQUMrQixjQUFjLEVBQUU7TUFDbEIsSUFBSUMsS0FBSyxHQUFHVCxZQUFZLENBQUNVLE9BQU8sQ0FBQyxPQUFPLENBQUM7TUFDekMsSUFBSUMsS0FBSyxHQUFHWCxZQUFZLENBQUNVLE9BQU8sQ0FBQyxPQUFPLENBQUM7TUFFekMsSUFBSVYsWUFBWSxDQUFDVSxPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDckNOLElBQUksR0FBRyxJQUFJZixHQUFHLENBQUNXLFlBQVksQ0FBQ1UsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO01BQ3ZELENBQUMsTUFBTTtRQUNITixJQUFJLEdBQUcsSUFBSWYsR0FBRyxDQUFDZ0IsTUFBTSxDQUFDZCxJQUFJLENBQUM7UUFDM0IsSUFBSWtCLEtBQUssSUFBSUUsS0FBSyxFQUFFO1VBQ2hCUCxJQUFJLENBQUNRLFFBQVEsR0FBRyxHQUFHLEdBQUdILEtBQUssR0FBRyxHQUFHLEdBQUdFLEtBQUs7UUFDN0M7TUFDSjtNQUVBbkIsTUFBTSxDQUFDYixPQUFPLENBQUMsVUFBVXVCLEtBQUssRUFBRTtRQUM1QixJQUFJZCxHQUFHLENBQUNNLFlBQVksQ0FBQ0MsR0FBRyxDQUFDTyxLQUFLLENBQUMsRUFBRTtVQUM3QkUsSUFBSSxDQUFDVixZQUFZLENBQUNtQixHQUFHLENBQUNYLEtBQUssRUFBRUYsWUFBWSxDQUFDVSxPQUFPLENBQUNSLEtBQUssQ0FBQyxDQUFDO1FBQzdEO01BQ0osQ0FBQyxDQUFDO01BRUY5RCxRQUFRLENBQUNrRCxRQUFRLENBQUNDLElBQUksR0FBR2EsSUFBSTtJQUNqQztFQUNKLENBQUMsQ0FBQztBQUNOLENBQUMsR0FBRyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgd2hlZWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxhbmRfX3doZWVsLWJ0blwiKTtcbmNvbnN0IHdoZWVsU2VjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5sYW5kX193aGVlbC1zZWN0b3JcIik7XG5jb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBcIik7XG5jb25zdCBwb3B1cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J0blwiKTtcblxuLy8g0IbQvdGW0YbRltCw0LvRltC30LDRhtGW0Y8g0LfQstGD0LrRltCyXG5jb25zdCBiYWNrZ3JvdW5kTXVzaWMgPSBuZXcgQXVkaW8oJ211c2ljLm1wMycpOyAvLyDRhNC+0L3QvtCy0LjQuSDQt9Cy0YPQuiwg0LPRgNCw0ZQg0L/QvtGB0YLRltC50L3QvlxuY29uc3QgcmVlbFNvdW5kID0gbmV3IEF1ZGlvKCdyZWVscy5tcDMnKTsgLy8g0LfQstGD0Log0LrRgNGD0YfQtdC90L3RjyDQutC+0LvQtdGB0LBcbmNvbnN0IHJlZWxTdG9wU291bmQgPSBuZXcgQXVkaW8oJ3JlZWwtc3RvcC5tcDMnKTsgLy8g0LfQstGD0Log0LrQvtC70Lgg0LLQuNC/0LDQtNCw0ZQg0YHQtdC60YLQvtGAXG5jb25zdCBwb3B1cFNvdW5kID0gbmV3IEF1ZGlvKCdwb3B1cC5tcDMnKTsgLy8g0LfQstGD0Log0LTQu9GPINC/0L7Qv9Cw0L/Rg1xuXG4vLyDQpNGD0L3QutGG0ZbRjyDQtNC70Y8g0LfQsNC/0YPRgdC60YMg0YTQvtC90L7QstC+0Zcg0LzRg9C30LjQutC4XG5mdW5jdGlvbiBwbGF5QmFja2dyb3VuZE11c2ljKCkge1xuICAgIGJhY2tncm91bmRNdXNpYy5wbGF5KCkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xufVxuXG4vLyDRgtCw0Log0Y/QuiDRgdGD0YfQsNGB0L3RliDQsdGA0LDRg9C30LXRgNC4INC70L7Rh9Cw0YLRjCDQsNCy0YLQvtCy0ZbQtNGC0LLQvtGA0LXQvdC90Y8g0LzRg9C30LjQutC4INC90LAg0YHQsNC50YLQsNGFLCDQstGW0YjQsNGU0Lwg0YHQu9GD0YXQsNGH0ZYg0L/QvtC00ZbQuSDRj9C60ZYg0LfQsNC/0YPRgdGC0Y/RgtGMINGX0ZdcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHBsYXlCYWNrZ3JvdW5kTXVzaWMsIHsgb25jZTogdHJ1ZSB9KTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBwbGF5QmFja2dyb3VuZE11c2ljLCB7IG9uY2U6IHRydWUgfSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlCYWNrZ3JvdW5kTXVzaWMsIHsgb25jZTogdHJ1ZSB9KTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBwbGF5QmFja2dyb3VuZE11c2ljLCB7IG9uY2U6IHRydWUgfSk7XG5wbGF5QmFja2dyb3VuZE11c2ljKClcblxucG9wdXBCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAocG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKFwiX2ZpcnN0XCIpKSB7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJfb3BhY2l0eVwiLCBcIl96SW5kZXhcIik7XG4gICAgICAgIHdoZWVsQnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImluaXRpYWxcIjtcbiAgICB9XG5cbn0pO1xuXG5sZXQgc3BpbkNvdW50ZXIgPSAwO1xuXG5mdW5jdGlvbiBzcGluV2hlZWwod2hlZWwsIGFuaW0sIHBvc2l0aW9uLCBwb3B1cCwgYnRuKSB7XG4gICAgd2hlZWwuY2xhc3NMaXN0LmFkZChhbmltKTtcblxuICAgIC8v0LfQstGD0Log0LrRgNGD0YfQtdC90L3RjyDQutC+0LvQtdGB0LBcbiAgICBzZXRUaW1lb3V0KCgpID0+e1xuICAgICAgICByZWVsU291bmQucGxheSgpO1xuICAgIH0sIDEwMDApXG5cbiAgICAvLyDQl9GD0L/QuNC90Y/RlNC80L4g0LfQstGD0Log0LrRgNGD0YfQtdC90L3RjyDQutC+0LvQtdGB0LBcbiAgICBzZXRUaW1lb3V0KCgpID0+e1xuICAgICAgICByZWVsU291bmQucGF1c2UoKTtcbiAgICAgICAgcmVlbFNvdW5kLmN1cnJlbnRUaW1lID0gMDtcbiAgICB9LCA0ODAwKVxuXG5cbiAgICB3aGVlbC5hZGRFdmVudExpc3RlbmVyKFwiYW5pbWF0aW9uZW5kXCIsICgpID0+IHtcbiAgICAgICAgd2hlZWwuY2xhc3NMaXN0LnJlbW92ZShhbmltKTtcbiAgICAgICAgd2hlZWwuc3R5bGUudHJhbnNmb3JtID0gYHJvdGF0ZSgke3Bvc2l0aW9ufWRlZylgO1xuXG5cblxuICAgICAgICAvLyDQt9Cy0YPQuiDQt9GD0L/QuNC90LrQuCDQutC+0LvQtdGB0LBcbiAgICAgICAgcmVlbFN0b3BTb3VuZC5wbGF5KCk7XG5cbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZChcIl9vcGFjaXR5XCIsIFwiX3pJbmRleFwiKTtcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoXCJfYnRuUHVsc2VcIik7XG5cblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+e1xuICAgICAgICAgICAgLy8g0JLRltC00YLQstC+0YDRjtGU0LzQviDQt9Cy0YPQuiDQtNC70Y8g0L/QvtC/0LDQv9GDXG4gICAgICAgICAgICBwb3B1cFNvdW5kLnBsYXkoKTtcbiAgICAgICAgfSwgNjAwKVxuXG4gICAgfSwgeyBvbmNlOiB0cnVlIH0pO1xufVxuXG53aGVlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHdoZWVsQnRuLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICBpZiAoc3BpbkNvdW50ZXIgPT09IDApIHtcbiAgICAgICAgd2hlZWxCdG4uY2xhc3NMaXN0LnJlbW92ZShcIl9idG5QdWxzZVwiKTtcbiAgICAgICAgc3BpbldoZWVsKHdoZWVsU2VjdG9yLCBcImZpcnN0U3BpblwiLCAxNjIwLCBwb3B1cCwgd2hlZWxCdG4pO1xuICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwiX2ZpcnN0XCIpO1xuICAgICAgICBzcGluQ291bnRlcisrO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHNwaW5Db3VudGVyID09PSAxKSB7XG4gICAgICAgIHdoZWVsQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJfYnRuUHVsc2VcIik7XG4gICAgICAgIHNwaW5XaGVlbCh3aGVlbFNlY3RvciwgXCJzZWNvbmRTcGluXCIsIDI3NDQuNSwgcG9wdXAsIHdoZWVsQnRuKTtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZChcIl9zZWNvbmRcIik7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJfZmlyc3RcIik7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT57XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFsbC1saW5rXCIpLmNsYXNzTGlzdC5yZW1vdmUoXCJfaGlkZGVuXCIpXG4gICAgICAgIH0sIDg1MDApXG5cbiAgICAgICAgc3BpbkNvdW50ZXIrKztcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn0pO1xuXG4vLyBwYXJhbGxheFxuY29uc3QgbW92ZVNwZWVkID0gMjYwO1xuXG5pZiAod2luZG93LmlubmVyV2lkdGggPiA5NTApIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHBhcmFsbGF4KTtcbn1cblxuZnVuY3Rpb24gcGFyYWxsYXgoZSkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGFyYWxsYXhcIikuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBtb3ZpbmdfdmFsdWUgPSBpdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIik7XG4gICAgICAgIGxldCB5ID0gKGUuY2xpZW50WCAqIG1vdmluZ192YWx1ZSkgLyBtb3ZlU3BlZWQ7XG4gICAgICAgIGxldCB4ID0gKGUuY2xpZW50WSAqIG1vdmluZ192YWx1ZSkgLyBtb3ZlU3BlZWQ7XG4gICAgICAgIGxldCB6ID0gKGUuY2xpZW50WSAqIG1vdmluZ192YWx1ZSkgLyBtb3ZlU3BlZWQgKiAyO1xuICAgICAgICBpdGVtLnN0eWxlLnRyYW5zZm9ybSA9IGBwZXJzcGVjdGl2ZSgzMDBweCkgdHJhbnNsYXRlM2QoJHt4fXB4LCAke3l9cHgsICR7en1weClgO1xuICAgIH0pO1xufVxuXG5cbi8vIFREUyBzY3JpcHRcblxuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7XG4gICAgdmFyIHBhcmFtcyA9IFsnbCcsICd1dG1fc291cmNlJywgJ3V0bV9tZWRpdW0nLCAndXRtX2NhbXBhaWduJywgJ3V0bV90ZXJtJywgJ3V0bV9jb250ZW50JywgJ3BhcmFtMScsICdwYXJhbTInLCAncGFyYW0zJywgJ3BhcmFtNCcsICdjcmVhdGl2ZV90eXBlJywgJ2NyZWF0aXZlX2lkJ107XG4gICAgdmFyIGxpbmtQYXJhbXMgPSBbJ2FmZmlkJywgJ2NwYWlkJ107IC8vINC40YnQtdC8INCyIHVybCByZWRpcmVjdFVybCDQsiB1cmw6XG5cbiAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMoJ3JlZGlyZWN0VXJsJykpIHtcbiAgICAgICAgdmFyIHJlZGlyZWN0VXJsID0gbmV3IFVSTCh1cmwuc2VhcmNoUGFyYW1zLmdldCgncmVkaXJlY3RVcmwnKSk7XG5cbiAgICAgICAgaWYgKHJlZGlyZWN0VXJsLmhyZWYubWF0Y2goL1xcLy9nKS5sZW5ndGggPT09IDQgJiYgcmVkaXJlY3RVcmwuc2VhcmNoUGFyYW1zLmdldCgnbCcpKSB7XG4gICAgICAgICAgICAvL9C10YHQu9C4INGB0YHRi9C70LrQsCDQsiDRgdGB0YvQu9C60LAgcmVkaXJlY3RVcmwg0LrQvtGA0YDQtdC60YLQvdCw0Y9cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdyZWRpcmVjdFVybCcsIHJlZGlyZWN0VXJsLmhyZWYpOyAvLyDRg9C60LDQt9GL0LLQsNC10Lwg0YLQvtGH0LrQvtC5INCy0YXQvtC00LAg0LTQvtC80LXQvSDRgSDQv9GA0L7RgtC+0LrQvtC70L7QvCDQuNC3IHJlZGlyZWN0VXJsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwYXJhbXMuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKHBhcmFtKSkgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocGFyYW0sIHVybC5zZWFyY2hQYXJhbXMuZ2V0KHBhcmFtKSk7XG4gICAgfSk7XG5cbiAgICBsaW5rUGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKGxpbmtQYXJhbSkge1xuICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMobGlua1BhcmFtKSkgbG9jYWxTdG9yYWdlLnNldEl0ZW0obGlua1BhcmFtLCB1cmwuc2VhcmNoUGFyYW1zLmdldChsaW5rUGFyYW0pKTtcbiAgICB9KTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBsaW5rLFxuICAgICAgICAgICAgcGFyZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnYScpO1xuXG4gICAgICAgIGlmIChwYXJlbnQuZ2V0QXR0cmlidXRlKCdocmVmJykgIT09ICdodHRwczovL3Rkcy5mYXZiZXQucGFydG5lcnMnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB2YXIgYWZmaWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWZmaWQnKTtcbiAgICAgICAgICAgIHZhciBjcGFpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjcGFpZCcpO1xuXG4gICAgICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJyZWRpcmVjdFVybFwiKSkge1xuICAgICAgICAgICAgICAgIGxpbmsgPSBuZXcgVVJMKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVkaXJlY3RVcmxcIikpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaW5rID0gbmV3IFVSTChwYXJlbnQuaHJlZik7XG4gICAgICAgICAgICAgICAgaWYgKGFmZmlkICYmIGNwYWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsucGF0aG5hbWUgPSAnLycgKyBhZmZpZCArICcvJyArIGNwYWlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKHBhcmFtKSkge1xuICAgICAgICAgICAgICAgICAgICBsaW5rLnNlYXJjaFBhcmFtcy5zZXQocGFyYW0sIGxvY2FsU3RvcmFnZS5nZXRJdGVtKHBhcmFtKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBsaW5rO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpOyJdfQ==
